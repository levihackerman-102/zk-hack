use bls_pedersen::bls::verify;
use bls_pedersen::data::puzzle_data;
use bls_pedersen::PUZZLE_DESCRIPTION;
use bls_pedersen::hash::hash_to_curve;
use prompt::{puzzle, welcome};

fn main() {
    welcome();
    puzzle(PUZZLE_DESCRIPTION);
    let (pk, ms, sigs) = puzzle_data();
    for (m, sig) in ms.iter().zip(sigs.iter()) {
        verify(pk, m, *sig);
    }

    /* Your solution here! */

    // Pedersen hash of github username
    let (digest_hash, _digest_point) = hash_to_curve("levihackerman-102".as_bytes());

    use ark_crypto_primitives::crh::pedersen::bytes_to_bits;
    let bits = bytes_to_bits(&digest_hash);
    let bits: Vec<u8> = bits.into_iter().map(|b| b as u8).collect();

    // order of the subgroup of G1
    println!("R = GF(0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001)");

    // Ax = B
    print!("A = matrix(R, [");
    for m in ms {
        let (digest, _point) = hash_to_curve(&m);
        let bits = bytes_to_bits(&digest);
        let bits: Vec<u8> = bits.into_iter().map(|x| x as u8).collect();
        print!("{:?}, ", bits);
    }
    println!("b = vector(R, {:?})", bits);

    // calculated in sol.sage
    let x = ["40057470520936488427032496222982976357146478757269865129312352187431632853641", "44666224814208315437099338350720513254637475337848787926829510744891478980228", "38232907518509658085978440558687445933236145903554383942671322234265551172436", "8115783302516181487711365644731280888958215366390859713366560846512361333612", "7378944641183554801859285643482890234987675310278923751370944498482329098904", "18363591959062439726268515403581230907729933039554453131193906578281922010460", "44086554089989335129263442744469474964055738760526244017240824354580129884716", "27516726013472942175424967156197336579176182663092362939416494518928521411070", "40056942477884044136902652557999484524494686110982839522097908153821488860899", "35838991196895144369354031247434885320887312101795465961509949291291854735880", "17349869408111096388545920125871178383270606739065170378737898974330641458043", "37435177213487192679715314761602561143917426091859805493800375493592644450145", "7768444293334493648595752815325718841228410516716444767644646144473761557919", "26436091524423912162517569126347348204102801020985513650212157603393384182296", "5625509820631278747423896382783154677240368118763241201777308586112752117470", "28093382597201698041829684505493603575153495830804771911365949196420713805901", "29718142728675882912631842979431431867227414723867513647123001966494353834141", "16929232442229519075249130560007360514089366824643321469226846560312725797232", "2186948938527160124389254918404117047244249726219243641314545973697903951794", "47062396664808339876927831384930088705552467079377921776160278176012194459280", "42003075958298453349859269828945634065570943863238752154362553534905314790584", "3581896271252139493593358182018660224774203546956876475712874549100135057433", "36100919455527967469607010861832534265486200271543131262428475207632521353276", "42708670234796007549957887905635018643001932645479701391013079517186473420849", "30790266867538425026833548261733765670404720766409545096328296981789045005192", "1008031658247238938850165380000403351992835050976232506161382154871466925276", "48935236030458406769044755295931362150274902256853987355130205335344585929493", "45960598797040018211037388161192136996462299764989235232900524977758440020635", "44684099228234494898629856588134968307465551327911762900936783507846157541653", "52298147468129807820545955925252252671656504436835261227314397880880485593013", "12652383261021701337427993891230431566844643976422322612770695297477175075873", "2195940291904169213237713282781508754910704902228501622389217982090393976416", "7889280031792036944197490603609156216232270984973906650781699226940435193852", "7589008781137141617831396453211102587687365895710267704001380535388509025745", "19773721108781051458636650144090942235781581663267676922280467885953757458597", "43094721804812207016206156138457491330979121622636466995618127244331009587193", "49692800371478747587269576656571397956244630975342595867408130345099126043378", "34977865915917842063188665184394805389195039108359425876479495658251368921938", "33914798331699798688106069033421996603991669183529956933688888445280512055475", "51656390493849513611660512640684190323696793819879753398466281266226717801529", "21911331144285013862100173096764823671095689016536162754565584073760522733247", "48239382495502813481040618930876149057329257133150090918449397056868086940800", "17359881066075124281121505914731665006183062706586571521899728692886069942083", "31047099660360980185879043202337472631547344111585100191343109733943072819716", "9650688180998816254956728672715399859399659221461585754721169954453927910881", "38949159634449157474096361245634915359849899290809540239115657381152491911000", "48618332429127252786199996574684734964764129886091132492960388203818148304299", "37848852888662024112957295993155833505000631920015063007431423616433999573152", "31998643843957818609115125036407826558850717944305219810204270388872008202455", "24455321350678213043970446519645299078780505985592085965679087305267756690953", "44203733296272170725837523595282057991682840328040976501614502408738596952274", "13273494816670528478113314948098660846331172038829708887535405444754964709445", "17863146777749444880625460598146710569213094762408376049207040079778477877746", "47981352564484288467908467321343563605326300713291328778945839550070079991702", "37543160073589831525027082805802103954788508747897389403025238767260580710398", "29798373313795196992204103035536805115887598418318542848187334098208119179940", "49244488829994439526024534899099293162902794700269515609604303162606639183806", "36724952068199671615638904677827155465699338846285901766118179789894888628869", "49718552773739987470710048122272259711871868508123939332659763352997821028603", "17715637907957266965230921283013019182437200736791884729922853168122633485160", "26892917147185647193036501493400600344483781410942872761988293240010448722743", "30643120596654598828781964186355967468461536445515646357194019871721124044146", "31799089652818716347372125039859700648976680843462475392756134469004603448081", "33947413770568457930757856153526097200609914931851791004691168128829993334317", "29994683000427404513710842316132689055241217447324275150239397281224917572405", "31155950576638058713813561549735655306167135510574760293446194820861580503149", "48857108582420417453986402781290408638728608070256205096404897149758974472079", "18604837089772783504740324334138696537995847284312075579162878943861200889994", "8359021937713276960351730236122090318522778772931636024319055875384694979335", "32044971343615980922910188744335755445262903843220792831947666291647952556429", "26176869473582472880095251758895313335548139342508990952775917627133227682559", "30798666662137533450794179084829490536419116140188669438470556401729144221695", "24167945178255055737074726430586011427274337104372738191725476921232176831157", "28622592634882650435224628341438535110224479182525118018151193190359703581604", "42729652705571199250018133234458241051615515192070768265451976382403088269187", "8158289863020885066792458854005721146717628012949592370734531784716846085471", "11243434593843132582957980420742305850314327989943190197823262520712737133427", "6726503139059316830651003458630102578208937919347740983570921233776632396025", "40511907376856482934613538741220056708106154107304383229946407707845669424157", "11674826768860573285110267480922526510899200066463672227477319580915708118485", "51013690247420892612162630912643465673830988244717353372401668326221687990025", "33501088421665696842871300733585381842770616639320129152749887139553591538756", "17371184933648350648037252696535341434203115396282385551243899491045607441776", "15032033217098183861545044848608185686215407099100447800145609796477115655355", "49421436522652422419872491463229330867514806490466871415805607663162537161776", "4494634675673945146622343336282986592713547459011053710239022354949125299172", "18292541061494787558150477289036089565677462729919561883134937059157387168658", "6049568435299863548298767819237920613950673051985006521941008652954681546891", "10358118959152048698436386554758931345075727289013245894290806653820047100114", "31580304782608401508374538745377180053175235523745427124086467826148697386709", "3383763452239848834446246161812414594763256900512988774301837583852416621169", "12673699592501690678555017688140884064439666359201527465913550108307376359976", "3679330044611646380791738139844684049819856402300531772968891583843998391918", "51886531635596627933782640839130322975925783448380091701917939019610869037508", "6016570566037526115497556875490286863153829528293452140327587947035020832", "28583857234203934885489136112221660690510145183306934802413394877166766388511", "26687615674477048789526429779063306293664640121241618582332053394828476149841", "4518245211758958956970554289669074050883175295889261873836846796642199837315", "11387133762979434153653595039825534771423509144406630630679354034370052568708", "49201266437269913716096719782280629741511513794832397623344583728335281660632", "52111765820582202745777753901026607313994818618556695902989220190610251330091", "51837477576163036828539707355428893360346817540382736717313597192445425094689", "12279168814332362411484188233183526649370939056836969240778051772781464147787", "20783216420069197716997301819356758540931575135682047134257708895698614832293", "48581334034677055570186352564894404723065715078033640448135879749201626525281", "40316781338763631729554361178452443144600610970489388603289460337267237759158", "31173690167215637389420971746601440569861772503010917997145997044413367112972", "6715988581143015265545768688750297641400224463220878865587146467817134181507", "49722195106170664176910163888377564413714630756153246434266852318705103935549", "47882779231841590106500783856675262852779451572201586240994790665710932648585", "47023995698417357968862599077245586639349696197315911278617008241563457788278", "45106772917934365583410198227499809568223257698544305227823889426779545002691", "27235984299713126219150552697213193478628337108610632398508137048775780543167", "51020987795116403677382037629925303704869709175219040885917787275489988816564", "22501343761890540178247036942097853176503212033693928934073443110569639384613", "20620133555543824130968613735301212448591118618004990551019200311027992039264", "4485855870384317287654851908830855600583595632569374418425945285848753299425", "14000300463740791594433776266992960324935443970421405318639243813016306410860", "19401647930507397265058930045641510113625697471710702183870579787719666211284", "27997725990912701131432015439585678610880827185846672507075487022625957363831", "51185489871600148831907621762307730789638338715923011059593906160328920362022", "13904241949349784963079136863249610582678464993348959331550061987807093398947", "46669321028745695929094071697811500946808906676177342522254875366348365030951", "73241661724851162508758197395913806669306664172122647128542451370035471943", "43711294903480826602292144269023718805884171674773512578425151027884515434940", "32234961643722990959864467341929111100497412945023252290254611744772938024888", "27823816438508530209069077244761728728078864150884412206412022887757773892253", "14628803846732270918256202893962840680749642830247973849938356343203279113393", "36495524187388554440692056199714392349437020554640738967295868191283349252182", "8316694927015555162853302826390525517140102762307675804680933950248600118514", "45391499109861127963776074312513694547857919454139946276971013512977596835249", "25401801646427036399000802955764754068031651710018382651535276127342659033563", "40387400272949736270511892214554994195846290186026204306311291983120246538192", "5146522800037119557871333997601876664132720448068027409256677681671897867630", "20075756612935691565062284344084053879135463061361493732603011775701592375762", "51090522234307547534303970191050080700711033616543884137353034695909465037163", "15573087169364137538422939111385353300524829178941428437388615087242613997070", "27334416714913671587520305573125687493752849645403777052333524385631483015940", "9584175760868422005797712515083180335185662972317807666296809058655808506553", "15956024610504416761694275744399610856898742975717928609409941312705327870826", "43730511556437666412426523872953913909496055017493067113528743481015980043612", "49130136852062525601553887927827768059021804682642879159175494147402529066815", "24627470470699875404653843350957438287341396824641470038050988901899837093577", "13131498263678251389896411458825668777310840056301863715108136037168474212975", "4625287580912133831511064428071408049201832271844733080456801452904349438904", "11391614703793959767498014020486341142377930468386008395181181669342969047768", "43950528474442862801703047148122935665318973873010268457596267554598970162565", "14245606327264091024149614959752159138647002702342165673893060792267716533224", "3468587341480717330989701269263835579604223007342549426900535525436132299081", "33065408433602095225944418591795918756589698481861700481249032770733927794273", "30869664354102995673261545922241322319826291168839459469672603167693501780560", "1031112111970017311549056615148887338278699503734712712717700788063804121929", "5356796412800793088439605754624093167402210715809930583108178117050466100548", "19152943027458775626451885330273905389012277879509715424776228133269887133534", "22340297149586790760047523555722671154818536179833765221075099883577017181902", "27797111904976973506378886583185035078927609726921927108261296875398535986007", "15029228130309999320137258652879282148171776588123060559447231311005008500229", "17750643303726357205982321381018823664282748149338129728893966961875030132523", "28133561140591628563675044826938450002291305837630640706091291076123349612952", "39888631875316454159271619253512410040073617617763252993226665717308895403214", "51012266556946339278670957422668328761629122391773550097068222679004018588514", "9372412005714776615338366083490731808059883599845010954130589377676817945967", "21988728110837844904913458111329685282371322952298896509442060621051802559271", "7045379308594231344979791856209648275716859367172753197966195280541354466558", "33968093941139193538966998917023011418876333967643979837028528664537666874102", "30279767958566326119240401795678296146010730961443192852420758186589584940265", "16241145045378649407158434083328882918439083002799364018652390740046928706136", "2543013674132113423420366477516534213308390816783610745050332411237779637644", "39804136753954759986489223046574979905753961714723934515712576157286606063121", "39914911669170677853540348088895522795915869581532350498628589967976255238225", "2402542679568120070563365958654367200853508163836005034040713342088574184472", "38529160009468086538808400565635837008757991702949459853840566627183030467357", "19274173521669048749651801498047676141919176202217144319875389036526425579959", "50682183073052377909737023021433723153735323460423878733408461909323902515590", "2805133658957856818476895790295223310998840512636317057641640911483255029788", "48670878035011243457123285901937785287484572384048480058183013710436892983298", "38853465901468722884856628524406195897153980469613860619039459825851293705193", "47261775083144272749927633151734053949106280996143531434637952989166949760698", "20862280396053964896250787673463115974215909546427251924746276855750802065806", "26463100143711496884268874609667011436995775942249586661620807507314713817443", "30125184874764802283178591701409986211400463293225493203132878960598964418291", "25710571643878556157439810700754600699832844873105739164952809478071327876484", "41759662550016033053605986675181287304161906937213532381283229468935516626686", "31540739167259979463966708724632503952809985156806750351782655366144620097085", "36599470152036218510508275264229144428183215746636014008557132140622432193145", "36619272185739678528027451374209548817291119798587714288897434501357857947685", "35310374238095486080065405883613791229913914259890297439415533239798199448722", "42306908759037972484376464891888752094739755167257178634496895156960629227865", "9472849177479316650046288913349951605137632772064165847223291145356853196349", "18696488408123026937300826886847196833786178962881032962649601878313793114523", "9840526029547014373520973536627963851375368524511094438554377783603524165962", "33959767392318360367730506659144261621381996702234816306035800912754613936799", "36721602314866269832407239172198091170795682232970531536721505183524527728385", "33838892959067108897722216313759100171612820670397948250230293072714171839364", "19222015434386910119263225353241675485664183717404586251360619877260681453440", "2452032310586313744596899488434812157886278670827555027931581302312251298371", "1716126704826673235350475195534253641826123030165250160624208717945360592101", "24315265874074792624800829869594947722298387294856056475256741280311285337395", "3702704331228485852052836896705373340096759839249797073576178097714460122135", "8794861609479266888464309863943506085064272171640706912897173391675747551230", "17207173875937713149656669091259345291793284071072965917339772470321750268703", "1294789254708129323069314706204122952451259636489117171490167243028621269949", "36681615772272351667395034878117696850602310545553559358281250736566031511505", "25048085213840640548654316599156638788793114422497563556497737098292952589091", "44994902892278909840132050151578905488762520795654168654208867164112223284104", "16886296814028210345595365477061796892956885779703187503149898658929274138103", "45755296777124645126965040612506560714267796748596572418187141046315877598756", "43736615055568046799050009287823516500859344372415353883337339610716896432460", "32742715949632840317347795300343062793114930837884184434578096935437315817981", "28403721981310368492279280591460684189083212500147298057554204764248452711664", "16370978240280332870274178886660244582077406886092964822484956497086816663840", "41318206409851426761379509247037318928299918845608326483970180112452664796138", "39847032555390881425580952313793372693231681152499050201608344010418120601695", "1400392262989830983353674380895982169780883327439713061849984649916411282644", "4718968961474785998746732382983343172515753722912680093066783792962540259381", "21841974537272841137898263249037694759098747365650475392242110868236486568604", "50647990090939719385258820622476282318947624691422535659253678747542733746343", "18873611392465954784633975700469755145545395984082030152202192472622795320569", "7891640495874779324981112883574796621336030911950794930814570866954298109176", "50694710643474045068155962345340719409788539893390063556741160250820909547851", "51748201694117752338541573766861645770510058369733598272252205847545414373314", "16458374124950241678340110770908089430319982226238769027085752721624689150281", "31372060810831975973239105947062638760256740313140504384393037817815332799764", "35953608383130477218142263733977354783822099293254721915023896589263080156974", "39408565966743196264171370749317849330175278760345151823670087723559187007714", "17558609920749142358517893489422451424632237626497580168030352440991433647278", "6057127580054794762583040835317455725284021210389052429939034180605053841248", "41132690813829863010068447709473942259603225160182158973376060465255663589875", "45183303907805139485000467743466716300995329648008485343020421453714212010325", "32225695748902953913919049558920920924259028227914955765600793881457854139887", "39620788402785715623560812702725663437023176251043821500436419670449682107370", "24270046843986693704142226132398523058911941274280828456519009033128583069216", "16530785555556346743008950805126020981748617645131694356020537299076917731120", "565727133782665973962967976834458865202130900974807717489124330783346247209", "17174650111578522227119590343536627581581824071097184841329287601247150528292", "10083134872514782537255842939982468763243574111381788297424791130348368882422", "25180527402304493676359410291151371474132118953195929487494633583103125392696", "46390895549353809306044144210627889003044656420677535176729815505165975462258", "41169049754252035452730877393199160301962511595540944450191889687041973315237", "47992261259842844171103005606604775618289592713617126099973665617206882271507", "13944930323949379285541840736932431235584913181415787990790190575624093488812", "51700763898904095774981648941775722287716886667228803683737591475384465841669", "1840106545338873511410133417931617775160671375979775569013691364964645452611", "27510487568711807754758602198587358069731306503009769844497046402977553883854", "41055287937503357756428173871236079110805237903758989921805246213514587172852", "35867549468345403169379244313155848741478502041510249159507623527990953954085", "41286384494167954794526704149531675041853947043047573567166000140305846708675", "5141089840463412277224325367510080076800861421211717144204194850743510511085", "3673071594185909781383562751842529638921368414841345237222737817754080271822", "22957892910694818372049259327843574749640762018443100700043604776480983629069", "15632015347015592913099031200692438105995052055415487500451040978833581842217", "18949546538980605376606922375263025201974781623951456344806553396522255352332", "11659019488196698062036021042132734233739802478002440009727712335463256826868", "18184018095452853517284749935001267257820576370662122611973222829918396047099", "22774254744034249192448194830902076477741003738997353443114125589470002506440", "46602819543530683878364183852835151760297076177943598082960275087450371095361"];
    
    use ark_bls12_381::{G1Projective, Fr};
    use ark_ec::AffineCurve;
    use std::str::FromStr;
    use num_traits::identities::Zero;
    
    let coeffs: Vec<_> = x.iter().map(|s| Fr::from_str(s).unwrap()).collect();
    let mut bad_sig = G1Projective::zero();
    
    for (coeff, sig) in coeffs.into_iter().zip(sigs) {
        bad_sig += sig.mul(coeff);
    }

    // the solution
    verify(pk, "levihackerman-102".as_bytes(), bad_sig.into());
}